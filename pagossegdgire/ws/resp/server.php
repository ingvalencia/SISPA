<?phprequire_once ("../common/config.php");require_once ("../common/clsSolicitudes.php");require_once ("../common/clsDatosFacturacion.php");require_once ("../common/class.WSPagos.php");require_once('nusoap.php'); $server = new nusoap_server;$server->configureWSDL('server', 'urn:server');$server->wsdl->schemaTargetNamespace = 'urn:server';$server->wsdl->addComplexType(    'data_response',    'complexType',    'struct',    'all',    '',    array(        'error' => array('name' => 'error', 'type' => 'xsd:int', 'description' => '1 indica que se presento un error 0 un error en caso contrario')		,'num_error' => array('name' => 'num_error', 'type' => 'xsd:string', 'description' => 'Identificador del error')        ,'msg' => array('name' => 'msg', 'type' => 'xsd:string', 'description' => 'Mensaje de la respuesta')    ));function validPago($folio_sol){	$solicitudes = new clsSolicitudes();	$datosFacturacion = new clsDatosFacturacion($solicitudes-> getLinkMysql());	$ficha = new WSPagos();		$resp = $solicitudes->search_solicitudes(array("folio_sol" => $folio_sol));					if(!$resp){		return array(			'error' => 1			,'num_error' => '#E001'			,'msg' => 'Comuniquee ocn el administrador'		);	}		/*	$ref = array(			"ref" => array(					   "ref" => $resp->solicitudes[0]->referencia_ban					   ,"monto" =>'$'.number_format($resp->solicitudes[0]->monto_total,2)					)			);		*/			$ref = array(			"ref" => array(					   "ref" => "5510117000490FY40220"					   ,"monto" => "$26800.00"					)			);			/*	return array(			'error' => 1			,'num_error' => '#E001'			,'msg' => $folio_sol."=>".$resp->solicitudes[0]->referencia_ban." => ".'$'.number_format($resp->solicitudes[0]->monto_total,2)		);		*/			//$folio =$resp->solicitudes[0]->folio_sol;	$folio = "20170311605";		foreach ($ref as $clave => $valor) {			$result =  $ficha->getStatus($valor);		$error_result= ($ficha->getResponse()->error);		$respuesta_result=$ficha->getResponse();		$ultimo = end($respuesta_result); 		if($result == WSP_SUCCESS) {			//Actualiza a la base el estado de pago    			$lstParam=array(				"fec_factura" => 'NOW()'				,"cve_edo_sol" => 'FINZ'				,"cve_edo_pago" => 'PFIN'				,"fec_termino_sol" => 'NOW()'			);			$resp = $solicitudes->updEdopago($id_solicitante, $folio, $lstParam);			$solicitudes->close();			$datosFacturacion->close();			if(!$resp){				return array(					'error' => 1					,'num_error' => '#E002'					,'msg' => "Error: No se puede actualizar el estado de pago. Comuniquee ocn el administrador"				);			}    			if($ultimo =="C"){								return array(					'error' => 0					,'num_error' => ''					,'msg' => "CONCILIADO"				);													}			if($ultimo =="SIN CONCILIAR"){								return array(					'error' => 0					,'num_error' => ''					,'msg' => "SIN CONCILIAR"				);							 }								}		else{     			return array(					'error' => 0					,'num_error' => ''					,'msg' => "El pago no se ha realizado"				);						}		}		}/* *******************************************************************funciones comunes de validacion********************************************************************/function validPassword($pass){	if(!preg_match('/^(?=.*\d)|(?=.*[A-Za-z])[0-9A-Za-z!@#$%]{8,12}$/', $pass)) return false;	return true;} /* fin*//* *******************************************************************funciones de validacion********************************************************************/function valid_user($d){		if($d == ""){		return array(			'error' => 1			,'num_error' => '#V001'			,'msg' => 'Usuario o password incorrectos'		);		}		$d = trim($d);		return array(		'error' => 0		,'num_error' => ''		,'msg' => 'Usuario valido'	);}function valid_pwd($d){		if($d == ""){		return array(			'error' => 1			,'num_error' => '#V002'			,'msg' => 'Usuario o password incorrectos'		);		}		$d = trim($d);			return array(		'error' => 0		,'num_error' => ''		,'msg' => 'usuario valido'	);}			//second function implementation function valid_pago($user, $pwd, $folios) {	/*	return array(		'error' => 0		,'num_error' => ''		,'msg' => $folios	);	*/		return validPago($folios);}					//this is the second webservice entry point/function $server->register('valid_pago',			array(			'user' => 'xsd:string'			,'pwd' => 'xsd:string'			,'folios' => 'xsd:string'			),  //parameters			array('return' => 'tns:data_response'),  //output			'urn:server',   //namespace			'urn:server#loginServer',  //soapaction			'rpc', // style			'encoded', // use			'Check user login');  //description				ob_clean();//$postdata = file_get_contents("php://input"); $POST_DATA = isset($GLOBALS['HTTP_RAW_POST_DATA'])? $GLOBALS['HTTP_RAW_POST_DATA'] : '';$server->service($POST_DATA);